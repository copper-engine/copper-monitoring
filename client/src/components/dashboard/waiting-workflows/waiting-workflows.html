<div class="waiting">
    <div class="summary">
        <h2 class="themeText--text">Waiting Workflows</h2>
        <v-flex class="text themeText--text">
            Total number of waiting workflows: {{ wfCount }}
        </v-flex>
    </div>

    <v-layout class="row-info primary textOnColor--text">
        <v-flex class="number">
            #
        </v-flex>  
        <v-flex class="data">
            Data
        </v-flex>  
        <v-flex class="engineId">
            Engine
        </v-flex>
        <v-flex class="processorPoolId">
            Processor Pool
        </v-flex>
        <v-flex class="state">
            State
        </v-flex>
        <v-flex class="priority">
            Priority
        </v-flex>
        <v-flex class="timeout">
            Timeout
        </v-flex>
        <v-flex class="timestamps">
            <div class="lastModTS">
                Last Modification
            </div>
            <div class="creationTS">
                Creation
            </div>            
        </v-flex>
        <v-flex class="actions">
            Details
        </v-flex>
    </v-layout>

    <v-layout class="workflows-cont" column>
        <v-card v-show="!workflows || workflows.length === 0" class="secondary">
            <v-card-text>
                <v-alert color="primary" icon="info" value="true" >
                    There are no available waiting workflows
                </v-alert>
            </v-card-text>
        </v-card>
            <v-flex class="workflow" v-for="(workflow, i) in workflows" :key="workflow.id"
            :class="{
            'highlight-workflow-deleting': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).deleting, 
            'highlight-workflow-layout': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).reloading, 
            'fade': workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton)
            }">
                <v-layout class="workflow-layout secondary" column>
                    <v-layout class="workflow-layout-header">
                        <v-flex class="number">
                            {{ (page - 1) * perPage + i + 1 }}
                        </v-flex>  
                        <v-flex class="data">
                            {{ workflow.workflowClassInfo.alias }}
                        </v-flex>  
                        <v-flex class="engineId">
                            {{ workflow.engineId }}
                        </v-flex>
                        <v-flex class="processorPoolId">
                            {{ workflow.processorPoolId }}
                        </v-flex>
                        <v-flex class="state">
                            {{ workflow.state }}
                        </v-flex>
                        <v-flex class="priority">
                            {{ workflow.priority }}
                        </v-flex>
                        <v-flex class="timeout">
                            <span v-if="workflow.timeout">
                                {{ workflow.timeout | moment("HH:mm DD/MM/YYYY") }}
                            </span>
                        </v-flex>
                        <v-flex class="timestamps">
                            <div class="lastModTS">
                                {{ workflow.lastModTS | moment("HH:mm DD/MM/YYYY") }}
                            </div>
                            <div class="creationTS">
                                {{ workflow.creationTS | moment("HH:mm DD/MM/YYYY") }}
                            </div>
                        </v-flex>                  
                        <v-flex class="actions">
                            <v-tooltip top content-class="tooltip-text">
                                <v-btn dark depressed
                                    color="primary"
                                    class="squareButton"
                                    :disabled="workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton || disabled)"                                                                
                                    @click="showDetails(workflow)"
                                    slot="activator">
                                    <v-icon :class="{ 'close-details-icon': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).open }">details</v-icon>
                                </v-btn>
                                <span>View Details</span>
                            </v-tooltip>
                        </v-flex>
                    </v-layout>
                    <v-layout class="workflow-info-layout" :class="{
                        'highlight-workflow-deleting': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).deleting, 
                        'highlight-workflow-layout': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).reloading, 
                        'fade': workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton)
                        }">
                        <transition name="extend">
                        <div class="details accent" v-show="workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).open">
                            <v-layout class="workflow-detail workflow-id">
                                <v-flex class="detail-label"> Workflow ID:</v-flex>
                                <v-flex class="text"> {{workflow.id}} </v-flex>                               
                            </v-layout>
                            <v-layout class="workflow-detail workflow-id">
                                <v-flex class="detail-label"> Workflow Data:</v-flex>
                                <v-flex class="text"> {{ workflow.dataAsString }} </v-flex>                               
                            </v-layout>
                            <v-layout class="workflow-detail class-info" row>
                                <v-flex class="detail-label">Class:</v-flex>
                                <v-flex class="text">
                                    {{workflow.workflowClassInfo.classname}}                                  
                                </v-flex> 
                                <v-spacer></v-spacer>
                                <v-flex class="stopGrow raise">
                                    <v-btn depressed color="primary" slot="activator" @click="showSourceCode(workflow)">Source Code</v-btn>
                                </v-flex>
                            </v-layout>
                            <v-layout class="workflow-detail version">
                                <v-flex class="detail-label">Version:</v-flex>
                                <v-flex class="text"> 
                                    {{workflow.workflowClassInfo.majorVersion}}.{{workflow.workflowClassInfo.minorVersion}}.{{workflow.workflowClassInfo.patchLevel}}
                                </v-flex>
                            </v-layout>
                            <v-layout class="workflow-detail stacktrace">
                                <v-flex class="detail-label">Last waiting Stack Trace:</v-flex>
                                <v-flex class="text">
                                    <code v-show="workflow.lastWaitStackTrace">
                                        {{ workflow.lastWaitStackTrace }}
                                    </code>
                                    <span v-show="!workflow.lastWaitStackTrace">There is no waiting stack trace</span>
                                </v-flex>
                            </v-layout>
                            <v-layout class="workflow-detail stacktrace">
                                <v-flex class="detail-label">Error Stack Trace:</v-flex>
                                <v-flex class="text">
                                    <code>
                                        {{ workflow.errorData ? workflow.errorData.exceptionStackTrace : '' }}
                                    </code>
                                </v-flex>
                            </v-layout>
                        </div>
                        </transition>
                    </v-layout>
                </v-layout>
            </v-flex>
    </v-layout>
</div>