<div class="workflows" :class="{'fade': disabled}" v-if="!newComponent">

    <workflow-heading 
    @triggerRestartAll="restartAll"
    @triggerApplyFilter="applyFilter($event)"
    @triggerRestartFiltered="restartFiltered($event)"
    @triggerDeleteFiltered="deleteFiltered($event)"
    :wfType="wfType"
    :engineStatus="status"
    :restartingAll="restartingAll"
    :deletingAll="deletingAll">
    </workflow-heading>
    
    <v-layout class="workflows-cont" column>
        <v-card v-show="!workflows || workflows.length === 0" class="secondary">
            <v-card-text>
                <v-alert color="primary" icon="info" value="true" >
                    There are no available {{ wfType }} workflows
                </v-alert>
            </v-card-text>
        </v-card>
            <v-flex class="workflow" v-for="(workflow, i) in workflows" :key="workflow.id"
            :class="{
            'highlight-workflow-deleting': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).deleting,
            'highlight-workflow-extended-deleting': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).deleting && workflowsContext.get(workflow.id).open,
            'highlight-workflow-layout': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).reloading, 
            'fade': workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton)
            }">
                <v-layout class="workflow-layout secondary" column>
                    <v-layout class="workflow-layout-header" :class="{ 'correct-height' : (wfType === 'waiting') }">
                        <v-flex class="number">
                            {{ (page - 1) * perPage + i + 1 }}
                        </v-flex>  
                        <v-flex class="data">
                            {{ workflow.workflowClassInfo.alias }}
                        </v-flex>  
                        <v-flex class="engineId">
                            {{ workflow.engineId }}
                        </v-flex>
                        <v-flex class="processorPoolId">
                            {{ workflow.processorPoolId }}
                        </v-flex>
                        <v-flex class="state" v-if="(wfType === 'broken')">
                            {{ workflow.state }}
                        </v-flex>
                        <v-flex class="priority">
                            {{ workflow.priority }}
                        </v-flex>
                        <v-flex class="timeout" v-if="(wfType === 'broken')">
                            <span v-if="workflow.timeout">
                                {{ workflow.timeout | moment("HH:mm DD/MM/YYYY") }}
                            </span>
                        </v-flex>
                        <v-flex class="timestamps">
                            <div class="errorTS" v-if="(wfType === 'broken')">
                                {{ !workflow.errorData ? '' : workflow.errorData.errorTS | moment("HH:mm DD/MM/YYYY") }}
                            </div>
                            <div class="creationTS">
                                {{ workflow.creationTS | moment("HH:mm DD/MM/YYYY") }}
                            </div>
                            <div class="lastModTS">
                                {{ workflow.lastModTS | moment("HH:mm DD/MM/YYYY") }}
                            </div>
                        </v-flex>                  
                        <v-flex :class="{ 'single-button' : (wfType === 'waiting'), 'actions' : (wfType === 'broken')}">
                            <v-tooltip top content-class="tooltip-text">
                                <v-btn dark depressed
                                    v-if="(wfType === 'broken')"
                                    color="primary"
                                    class="squareButton"
                                    :loading="workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).reloadButton"
                                    :disabled="workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton || disabled)"
                                    @click="restart(workflow.id)"
                                    slot="activator"
                                    >
                                    <v-icon>cached</v-icon>
                                </v-btn>
                                <span>Restart Workflow</span>
                            </v-tooltip>
                            <v-tooltip top content-class="tooltip-text">
                                <v-btn dark depressed
                                    v-if="(wfType === 'broken')"
                                    color="primary"
                                    class="squareButton"
                                    :loading="workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).deleteButton"
                                    :disabled="workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton || disabled)"                                
                                    @click="deleteBroken(workflow.id)"
                                    slot="activator">
                                    <v-icon>delete</v-icon>
                                </v-btn>
                                <span>Delete Workflow</span>
                            </v-tooltip>
                            <v-tooltip top content-class="tooltip-text">
                                <v-btn dark depressed
                                    color="primary"
                                    class="squareButton"
                                    :disabled="workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton || disabled)"                                                                
                                    @click="showDetails(workflow)"
                                    slot="activator">
                                    <v-icon :class="{ 'close-details-icon': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).open }">details</v-icon>
                                </v-btn>
                                <span>View Details</span>
                            </v-tooltip>
                        </v-flex>
                    </v-layout>
                    <v-layout class="workflow-info-layout" :class="{
                        'highlight-workflow-details-deleting': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).deleting && workflowsContext.get(workflow.id).open, 
                        'highlight-workflow-layout': workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).reloading, 
                        'fade': workflowsContext.get(workflow.id) && (workflowsContext.get(workflow.id).reloadButton || workflowsContext.get(workflow.id).deleteButton)
                        }">
                        <transition name="extend">
                        <div class="details accent" v-show="workflowsContext.get(workflow.id) && workflowsContext.get(workflow.id).open">
                            <v-layout class="workflow-detail workflow-id">
                                <v-flex class="detail-label"> Workflow ID:</v-flex>
                                <v-flex class="text"> {{workflow.id}} </v-flex>                               
                            </v-layout>
                            <v-layout class="workflow-detail workflow-id">
                                <v-flex class="detail-label"> Workflow Data:</v-flex>
                                <v-flex class="text"> {{ workflow.dataAsString }} </v-flex>                               
                            </v-layout>
                            <v-layout class="workflow-detail class-info" row>
                                <v-flex class="detail-label">Class:</v-flex>
                                <v-flex class="text">
                                    {{workflow.workflowClassInfo.classname}}                                  
                                </v-flex> 
                                <v-spacer></v-spacer>
                                <v-flex class="stopGrow raise">
                                    <v-btn depressed color="primary" slot="activator" @click="showSourceCode(workflow)">Source Code</v-btn>
                                </v-flex>
                            </v-layout>
                            <v-layout class="workflow-detail version">
                                <v-flex class="detail-label">Version:</v-flex>
                                <v-flex class="text"> 
                                    {{workflow.workflowClassInfo.majorVersion}}.{{workflow.workflowClassInfo.minorVersion}}.{{workflow.workflowClassInfo.patchLevel}}
                                </v-flex>
                            </v-layout>
                            <v-layout class="workflow-detail stacktrace" v-if="(wfType === 'broken')">
                                <v-flex class="detail-label">Last waiting Stack Trace:</v-flex>
                                <v-flex class="text">
                                    <code v-show="workflow.lastWaitStackTrace">
                                        {{ workflow.lastWaitStackTrace }}
                                    </code>
                                    <span v-show="!workflow.lastWaitStackTrace">There is no waiting stack trace</span>
                                </v-flex>
                            </v-layout>
                            <v-layout class="workflow-detail stacktrace" v-if="(wfType === 'broken')">
                                <v-flex class="detail-label">Error Stack Trace:</v-flex>
                                <v-flex class="text">
                                    <code>
                                        {{ workflow.errorData ? workflow.errorData.exceptionStackTrace : '' }}
                                    </code>
                                </v-flex>
                            </v-layout>
                        </div>
                        </transition>
                    </v-layout>
                </v-layout>
            </v-flex>
    </v-layout>

    <v-dialog v-model="dialog" scrollable max-width="800px" position="absolute">
        <v-card>
            <v-card-title position="absolute">
                <h2>{{ sourceCodeAvailable ? 'Source Code' : 'Source Code - Not Available' }}</h2>
                <v-spacer></v-spacer>                  
                    <v-btn depressed class="squareButton" color="primary" @click="dialog = false"><v-icon>mdi-close</v-icon></v-btn>      
            </v-card-title>
            <v-divider></v-divider>
            <v-card-text>
                <div>
                    <source-code :sourceCode="dialogSourceCode" :highliteLines="dialogHighlitedlines"></source-code>
                </div>
            </v-card-text>
        </v-card>
    </v-dialog>

    <workflow-footer
    @updatePage="page = $event"
    @updatePerPage="perPage = $event"
    :page="page"
    :perPage="perPage"
    :totalPages="totalPages"
    :perPageItems="perPageItems">
    </workflow-footer>

</div>